
# NowMail

**NowMail** — это мощная библиотека Python для создания и управления временными почтовыми ящиками с использованием [1secmail.com](https://www.1secmail.com/) API. NowMail предлагает асинхронные и синхронные методы для генерации временных ящиков, проверки сообщений и получения полного содержимого сообщений. Также включает автоматическую проверку почтовых ящиков с заданными интервалами.

---

## Установка

Установите NowMail с помощью `pip`:

```bash
pip install nowmail
```

---

## Основные возможности

- **Создание временных почтовых адресов**: Создание одного или нескольких временных почтовых адресов.
- **Проверка и получение сообщений**: Проверка новых сообщений и получение их содержимого.
- **Автоматическая проверка ящиков**: Запуск автоматического мониторинга почтового ящика с заданными интервалами.
- **Обработка ошибок**: Включает встроенные исключения для обработки сетевых и API ошибок.

---

## Быстрый старт

Краткое руководство по использованию NowMail.

### Синхронный пример

```python
from nowmail import generate, check, fetch

# Создание временного почтового адреса
email_addresses = generate(1)
print("Созданные адреса:", email_addresses)

# Разделяем логин и домен из адреса
login, domain = email_addresses[0].split('@')

# Проверяем почтовый ящик на наличие сообщений
messages = check(login, domain)
if messages:
    message_id = messages[0].id
    # Получаем полное содержимое сообщения
    message = fetch(login, domain, message_id)
    print("Содержимое сообщения:", message.body)
else:
    print("Новых сообщений нет.")
```

### Асинхронный пример

```python
import asyncio
from nowmail.api.async_api import async_generate, async_check, async_fetch

async def main():
    # Асинхронное создание адресов электронной почты
    email_addresses = await async_generate(1)
    print("Созданные адреса:", email_addresses)

    login, domain = email_addresses[0].split('@')
    # Асинхронная проверка почтового ящика на сообщения
    messages = await async_check(login, domain)
    if messages:
        message_id = messages[0].id
        # Асинхронное получение содержимого сообщения
        message = await async_fetch(login, domain, message_id)
        print("Содержимое сообщения:", message.body)
    else:
        print("Новых сообщений нет.")

asyncio.run(main())
```

### Автоматическая проверка почтового ящика

Используйте `start_checker` из NowMail для непрерывного мониторинга почтового ящика и автоматического получения сообщений.

```python
from nowmail import start_checker

# Запуск периодической проверки
checker = start_checker("example", "tempmail.com", interval=15, duration=60)
message = checker()
if message:
    print("Новое сообщение:", message.body)
else:
    print("В указанное время новых сообщений нет.")
```

---

## Подробное описание API

NowMail предоставляет несколько модулей для управления временными почтовыми ящиками и периодической проверки сообщений.

### Основные модули

#### `client.py`

Класс `TempMailClient` управляет взаимодействиями с API временной почты. Поддерживает асинхронное создание почтовых ящиков, проверку и получение сообщений.

#### `periodic_checker.py`

`PeriodicChecker` автоматизирует проверку почты, позволяя запустить отдельный поток для непрерывного мониторинга почтового ящика.

#### `exceptions.py`

Пользовательские исключения для обработки ошибок:

- `MailServiceError`: Базовое исключение для NowMail.
- `NetworkError`: Выбрасывается при сетевых проблемах.
- `APIError`: Выбрасывается, если API возвращает ошибку.

### Конфигурация

Вы можете настроить NowMail, используя переменные окружения или модуль `config.py`:

- **BASE_URL**: Устанавливает базовый URL API.
- **TIMEOUT**: Устанавливает тайм-аут для запросов (по умолчанию 10 секунд).

---

## Зависимости

Для работы NowMail требуются следующие зависимости:

```plaintext
aiohappyeyeballs==2.4.3
aiohttp==3.10.10
aiosignal==1.3.1
async-timeout==4.0.3
certifi==2024.8.30
charset-normalizer==3.4.0
email_validator==2.2.0
lxml==5.3.0
nest-asyncio==1.6.0
pydantic==2.9.2
requests==2.32.3
tenacity==9.0.0
yarl==1.16.0
```

---

## Обработка ошибок

NowMail включает надежную обработку ошибок. В случае возникновения сетевых проблем или ошибок API, NowMail выбрасывает специфичные исключения с деталями о типе ошибки.

- **NetworkError**: Выбрасывается при проблемах с подключением.
- **APIError**: Выбрасывается, если API возвращает сообщение об ошибке.

---

## Тестирование

Для запуска тестов можно использовать `pytest`. Убедитесь, что установлены зависимости для разработки, указанные в `install.me`.

```bash
pytest --cov=nowmail tests/
```

---
